language: node_js
matrix:
  include:
    - node_js: 6.14.0
    - node_js: 6.14.0
      env: SAUCE=true
    - node_js: 6.14.0
      env: INTEGRATION=true
script:
  - |
    echo "machine github.com login stellar-jenkins password $GITHUB_TOKEN" >~/.netrc
    git config --global user.name "Travis CI"
    git config --global user.email "travis@stellar.org"
    if [ "${SAUCE}" = "true" ]; then
      if [ "${TRAVIS_PULL_REQUEST}" = "false" ]; then
        gulp test:sauce
      else
        echo "Pull request - skip Sauce Labs testing..."
      fi
    elif [ "${INTEGRATION}" = "true" ]; then
      # Ugly but it's the only way to make istanbul generate coverage report
      gulp test:integration
    else
      gulp test:unit
    fi
after_success:
  - |
    # Send report to coveralls but only once
    if [ "${INTEGRATION}" = "true" ] && [ "${TRAVIS_BRANCH}" = "master" ] ; then
      gulp submit-coverage
    fi
env:
  global:
    - secure: Pc3DwkXywnOGAhUdBZiUCKjyljzrQzPoqm9EEr+UL2BaeaDniFLCLEkuU+ViiuJBo8oPyOIl7I+d86Mi5q06fQx55+xH7DmiW/aj4qKVB2U6Ghn6A3QWkQuvRB1o8SP7iTYRCX480ULZs6AGrMd9y1PFRx/L93fBrO+J/bOtEmg=
notifications:
  slack:
    secure: CgXxNEQrQ82EatyF/wSdF0P5rXcWPL+fFZ1lb1aBb8RbVt5gwddJ6xWVD/nYSr6tIJvIYHYhoYsIDPENwezIPsesG7kWXerQhydsEcA34JKxzsStd/TmU6Moxuwy6KTN7yzmL6586nSvoAw9TNPgvRkJFkH07asjGIc9Rlaq7/Y=
before_deploy: gulp build
after_deploy: './after_deploy.sh'
deploy:
  - provider: npm
    email: npm@stellar.org
    api_key:
      secure: VmLreZhQBusSwCwsy7rORXFSKmK1B5TnmWmVBZ5DlxMqLAagbnIs/y/LVsybjd6AByHbXoAeEeGcShwMS13xfuVvWc5HZUJeJyZVKuZq3/FjvFiHAX2V/04++21NcxMHPcgI+/GFCauAuTg9OiE15VnrjFXP9R0YSJK3mutVqM61HoKNuRwJNXYj5BDXfxdtuKf2ENpfRdhQyUdOO3iAsL9FycC2HP605YXfyNuT9FfoUTc5t+O0sIMZg9jJAMbPnzgKwjwDV486qrzMDYlSKhRWpsf4a6SmwzwkF3nWFIv/9tPAH0TrUbNVXydy8YbEK7Cc+BhlL9IZWnThXI46N7Q5ucMbJ2M7q4gkJg/3TvcK/+X+P5t5KAt1JYHpd1hLvQDkgaQC/L/9PHoqzs4x9BoahhA40yUZ3OEKCpnNBctLqGP5I3oOGszXw96SwpqxqGoKbuHTJbduDhSI+3ToG0I9Xkgr26b+wR7aOXCxUX1KYymhaP8EXj2M5pHoN4k3H/8/OVNaScZA/lELoOVkCY041mSCPExsD8/868PR3Lk6P1HF+un5cs5Wk43997VX80s+jd9yfXaqvHAhEvC9Qx1KKS96MGp5Y4b39pXRqT8DfYZ9QR4+5Ern2CzfNl+H+KxNWpQrJXCkXVb7CuZEX2sSfotFM4/UwTwNaGSctkg=
    skip_cleanup: true
    on:
      tags: true
      repo: stellar/js-stellar-sdk
      node: 6.14.0
      condition: '$INTEGRATION = true'
  - provider: script
    script: './bower_publish.sh'
    skip_cleanup: true
    on:
      tags: true
      repo: stellar/js-stellar-sdk
      node: 6.14.0
      condition: '$INTEGRATION = true'
